<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>beLive - –¢—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –¥–ª—è –º—É–∑—ã–∫–∞–Ω—Ç–æ–≤</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/transport-controls.css">
    <link rel="stylesheet" href="css/karaoke-styles.css">
    <link rel="stylesheet" href="css/live-mode.css">
    <link rel="stylesheet" href="css/mode-buttons-override.css">
    <link rel="stylesheet" href="css/font-selector.css">
    <link rel="stylesheet" href="css/waveform-source-switcher.css">
    <link rel="stylesheet" href="css/bpm-controls.css">
    <link rel="stylesheet" href="css/rehearsal-mode.css">
    <link rel="stylesheet" href="css/block-mode.css">
    <link rel="stylesheet" href="css/karaoke-mode.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Add JSZip library for backup system -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- MediaPipe Official CDN Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js" crossorigin="anonymous"></script>
    
    <!-- Pitchy Library for Professional Pitch Detection -->
    <script type="module">
        import { PitchDetector } from "https://esm.sh/pitchy@4";
        window.PitchDetector = PitchDetector;
        console.log('‚úÖ Pitchy –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ beLive');
    </script>
    <link rel="stylesheet" href="css/rehearsal-styles.css">
    <link rel="stylesheet" href="css/concert-styles.css">
    <link rel="stylesheet" href="css/karaoke-styles.css">
    <link rel="stylesheet" href="css/mobile-controls.css">
    <link rel="stylesheet" href="css/audio-settings.css">

    <!-- Google Fonts for Font Selector -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&family=Bebas+Neue&family=Playfair+Display:wght@400;700&family=Merriweather:wght@400;700&family=Lora:wght@400;700&family=PT+Serif:wght@400;700&family=Oswald:wght@400;700&family=Lobster&family=Pacifico&family=Caveat&display=swap" rel="stylesheet">

    <!-- Existing stylesheets -->
    <link rel="stylesheet" href="css/director.css">
</head>
<body>
    <div class="app-container">
        <!-- 1. –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º –∏ –∫–Ω–æ–ø–∫–∞–º–∏ —Ä–µ–∂–∏–º–æ–≤ -->
        <header class="app-header">
            <div class="header-content glass-effect">
                <!-- –ì—Ä—É–ø–ø–∞ 1: –õ–æ–≥–æ—Ç–∏–ø –∏ –ª–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã -->
                <div class="header-left-group">
                <button id="home-btn" class="home-btn" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É">
                    <span class="home-logo">beLIVE</span>
                </button>
                </div>
                
                <!-- BPM –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–µ–ø–µ—Ç–∏—Ü–∏–∏ (–ø–µ—Ä–µ–¥ —Ä–µ–∂–∏–º–∞–º–∏) -->
                <div class="bpm-controls" id="bpm-controls" style="display: none;">
                    <button class="bpm-btn" id="bpm-down" title="–ó–∞–º–µ–¥–ª–∏—Ç—å —Ç–µ–º–ø –Ω–∞ 5%">‚àí5</button>
                    <button class="bpm-btn bpm-value-btn" id="bpm-value" title="–°–±—Ä–æ—Å–∏—Ç—å –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É —Ç–µ–º–ø—É">100%</button>
                    <button class="bpm-btn" id="bpm-up" title="–£—Å–∫–æ—Ä–∏—Ç—å —Ç–µ–º–ø –Ω–∞ 5%">+5</button>
                </div>

                <!-- –ì—Ä—É–ø–ø–∞ 2: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ä–µ–∂–∏–º–æ–≤ (–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω–æ) -->
                <div class="mode-buttons">
                    <button id="concert-mode" class="mode-button btn-concert" data-mode="concert">–ö–æ–Ω—Ü–µ—Ä—Ç–Ω—ã–π</button>
                    <button id="karaoke-mode" class="mode-button btn-karaoke" data-mode="karaoke">–ö–∞—Ä–∞–æ–∫–µ</button>
                    <button id="rehearsal-mode" class="mode-button btn-rehearsal" data-mode="rehearsal">–†–µ–ø–µ—Ç–∏—Ü–∏—è</button>
                    <button id="live-mode" class="mode-button btn-live" data-mode="live">LIVE</button>
                    <button id="audio-settings-btn" class="mode-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ">
                        <span class="icon">üéõÔ∏è</span>
                        <span class="label">–ê—É–¥–∏–æ</span>
                    </button>
                </div>
                
                <!-- –ì—Ä—É–ø–ø–∞ 3: –ü—Ä–∞–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–ö–∞—Ç–∞–ª–æ–≥ –∏ –ú–∞—Å—à—Ç–∞–±) -->
                <div class="header-right-group">
                    <div class="scale-controls">
                        <button class="scale-btn" id="scale-down" title="–£–º–µ–Ω—å—à–∏—Ç—å —à—Ä–∏—Ñ—Ç">-</button>
                        <button class="scale-btn scale-value-btn" id="scale-value" title="–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±">100%</button>
                        <button class="scale-btn" id="scale-up" title="–£–≤–µ–ª–∏—á–∏—Ç—å —à—Ä–∏—Ñ—Ç">+</button>
                    </div>
                    <button id="catalog-btn" class="animated-gradient-btn">Catalog</button>
                </div>
            </div>
        </header>
        
        <!-- 3. –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ–∫—Å—Ç–∞ -->
        <div id="lyrics-container">
            <div id="lyrics-display">
                <div class="welcome-message">
                    <h1>Welcome to beLIVE</h1>
                    <p>Your lyrics assistant for live performances</p>
                    <p>Click the Catalog button to start adding tracks</p>
                </div>
            </div>
        </div>
        
        <!-- 4. –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–µ–µ—Ä–æ–º (–ü–ï–†–ï–ú–ï–©–ï–ù–ê –í–ù–ò–ó) -->
        <div id="transport-controls">
            <div class="transport-controls-row" id="main-control-groups">
                <!-- Group 1: Playback -->
                <div class="control-group">
                    <button id="play-pause" class="unified-btn">Play</button>
                    <button id="reload-app" class="unified-btn" title="Restart the application">‚Üª Reload</button>
                </div>
                
                <!-- Group 2: Volume -->
                <div class="control-group">
                <div class="volume-controls">
                    <div class="volume-control">
                        <label>Instrumental</label>
                            <input type="range" id="instrumental-volume" class="volume-slider" min="0" max="100" value="100">
                    </div>
                    <div class="volume-control">
                        <label>Vocals</label>
                            <input type="range" id="vocals-volume" class="volume-slider" min="0" max="100" value="100">
                        </div>
                    </div>
                </div>
                
                <!-- Group 3: Core Tools -->
                <div class="control-group">
                    <button id="toggle-loopblock-mode" class="unified-btn" title="Toggle LoopBlock Mode">Loop</button>
                    <button id="style-selector-btn" class="unified-btn" title="Select text style">
                    <i class="fas fa-text-height"></i> Styles
                </button>
                    <button id="piano-keyboard-btn" class="unified-btn" title="–ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏">
                        <i class="fas fa-chart-line"></i> Pitch
                </button>
                    <button id="mask-mode-btn" class="unified-btn" title="–ú–∞—Å–∫–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã">
                        <i class="fas fa-theater-masks"></i> –ú–∞—Å–∫–∏
                </button>
                </div>

                <!-- Group 4: Sync & Mic -->
                <div class="control-group">
                    <button id="sync-btn" class="unified-btn" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ –º—É–∑—ã–∫–∏">Sync</button>
                    <div class="mic-control">
                        <span>Mic:</span>
                        <input type="range" id="mic-volume" class="mic-volume-slider volume-slider" min="0" max="100" value="70" title="–ì—Ä–æ–º–∫–æ—Å—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞">
                        <button id="mic-toggle-btn" class="unified-btn" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω">
                            <i class="fas fa-microphone"></i>
                </button>
                    </div>
                </div>

                <!-- Group 5: Catalog -->
                <div class="control-group">
                    <!-- BUTTON MOVED TO HEADER -->
                </div>
            </div>
            
            <div class="transport-controls-row" id="progress-and-toggle-row">
                <div id="transport-toggle" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è">
                    <i class="fas fa-sliders-h"></i>
                </div>
                <div id="time-display">0:00 / 0:00</div>
                <div id="progress-bar-container">
                    <div id="progress-bar-loaded"></div>
                    <div id="progress-bar"></div>
                    <div id="progress-tooltip">0:00</div>
                </div>
            </div>
        </div>
        
        <!-- Piano Keyboard Container (initially hidden) -->
        <div id="piano-keyboard-container" class="hidden">
            <div class="piano-header">
                <button id="back-to-transport" class="back-button" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–π –ø–∞–Ω–µ–ª–∏">
                    <i class="fas fa-arrow-left"></i> –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
                </button>
                <h2>üéπ –ê–Ω–∞–ª–∏–∑ –≤–æ–∫–∞–ª–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h2>
                <div class="piano-status" id="piano-status">–ì–æ—Ç–æ–≤ –∫ –∞–Ω–∞–ª–∏–∑—É</div>
            </div>
            
            <!-- Professional Settings (compact) -->
            <div class="piano-settings">
                <div class="setting-group">
                    <label>üéµ –î–∏–∞–ø–∞–∑–æ–Ω: <span id="piano-freq-range">65-1050 Hz</span></label>
                    <input type="range" id="piano-freq-range-slider" min="50" max="2000" value="1050" step="50">
                </div>
                <div class="setting-group">
                    <label>üéØ –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <span id="piano-sensitivity">80%</span></label>
                    <input type="range" id="piano-sensitivity-slider" min="50" max="95" value="80" step="5">
                </div>
                <div class="setting-group">
                    <label>üßπ –§–∏–ª—å—Ç—Ä: <span id="piano-filter">200–º—Å</span></label>
                    <input type="range" id="piano-filter-slider" min="50" max="500" value="200" step="50">
                </div>
            </div>
            
            <!-- Piano Visualization Area -->
            <div class="piano-visualization">
                <canvas id="piano-canvas"></canvas>
            </div>
        </div>
        
        <!-- Track Catalog (initially hidden) -->
        <div id="track-catalog" class="hidden">
            <div class="catalog-header">
                <h2>Track Catalog</h2>
                <div class="catalog-actions">
                    <button id="clear-catalog" class="btn-danger" title="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–∫–∏ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞">–û—á–∏—Å—Ç–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥</button>
                    <button id="close-catalog">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
            <div id="catalog-tracks"></div>
            <div id="upload-section">
                <h3>Upload New Track</h3>
                <div class="upload-container">
                    <div class="upload-row">
                        <div class="upload-box">
                            <label>Instrumental Track</label>
                            <div id="instrumental-dropzone" class="dropzone">
                                <div class="dropzone-content">
                                    <div class="icon">üéπ</div>
                                    <p>Drop track file</p>
                                </div>
                                <input type="file" id="instrumental-upload" accept="audio/*">
                            </div>
                        </div>
                        
                        <div class="upload-box">
                            <label>Vocals Track (optional)</label>
                            <div id="vocals-dropzone" class="dropzone">
                                <div class="dropzone-content">
                                    <div class="icon">üé§</div>
                                    <p>Drop vocals file</p>
                                </div>
                                <input type="file" id="vocals-upload" accept="audio/*">
                            </div>
                        </div>
                        
                        <div class="upload-box">
                            <label>Lyrics</label>
                            <div id="lyrics-dropzone" class="dropzone">
                                <div class="dropzone-content">
                                    <div class="icon">üìù</div>
                                    <p>Drop text file</p>
                                </div>
                                <input type="file" id="lyrics-upload" accept=".txt,.text,.lrc,.md,.rtf,.doc,.docx,.srt,.sub,.vtt,.ass,.ssa,.xml,.json,.csv,text/plain,text/rtf,application/rtf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/*,application/json,application/xml">
                            </div>
                        </div>
                    </div>
                    
                    <button id="upload-btn">Upload Track</button>
                    
                    <div class="import-markers-container">
                        <hr>
                        <h3>Restore Track Markers</h3>
                        <p class="info-text">Import track markers from a previously saved JSON file</p>
                        <div class="import-box">
                            <input type="file" id="import-markers-input" accept=".json" style="display:none">
                            <button id="import-markers-btn" class="btn-secondary">
                                <span class="icon">üì•</span> Import Markers
                            </button>
                            <span id="import-file-name">No file selected</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Style Selector Container (initially hidden) - REMOVED, handled by JS -->
        
        <!-- –ö–æ–Ω—Ü–µ–ø—Ü–∏—è "–ñ–∏–≤–∞—è –õ–µ–Ω—Ç–∞" (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <div id="live-feed-concept" class="hidden">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <header class="live-feed-header">
                <div class="logo">
                    <span class="logo-text">beLIVE</span>
                    <span class="tagline">–ñ–∏–≤–∞—è –ª–µ–Ω—Ç–∞</span>
                </div>
                <div class="user-info">
                    <div class="progress-ring">
                        <div class="daily-progress">
                            <span class="progress-text">3/5</span>
                            <span class="progress-label">—Ü–µ–ª–∏</span>
                        </div>
                    </div>
                    <div class="user-avatar">üë§</div>
                </div>
                <button id="back-to-hall" class="back-to-hall-btn" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∑–∞–ª">
                    ‚Üê –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∑–∞–ª
                </button>
            </header>
            
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <main class="live-feed-main">
                <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: Live –ø–æ—Ç–æ–∫–∏ -->
                <section class="live-streams">
                    <div class="section-header">
                        <h2>üî¥ Live Streams</h2>
                        <div class="filter-tabs">
                            <button class="tab active" data-filter="karaoke">–ö–∞—Ä–∞–æ–∫–µ</button>
                            <button class="tab" data-filter="training">–û–±—É—á–µ–Ω–∏–µ</button>
                            <button class="tab" data-filter="duet">–î—É—ç—Ç—ã</button>
                        </div>
                    </div>
                    
                    <div class="streams-grid">
                        <div class="stream-card" data-type="karaoke">
                            <div class="stream-preview">
                                <div class="stream-thumbnail">üé§</div>
                                <div class="live-indicator">LIVE</div>
                                <div class="viewer-count">1.2K</div>
                            </div>
                            <div class="stream-info">
                                <h3>–ê–Ω–Ω–∞ –ø–æ–µ—Ç —Ä–æ–∫-—Ö–∏—Ç—ã</h3>
                                <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –∫–∞—Ä–∞–æ–∫–µ!</p>
                                <div class="stream-actions">
                                    <button class="join-btn">üéµ –°–ø–µ—Ç—å –¥—É—ç—Ç</button>
                                    <button class="watch-btn">üëÅÔ∏è –°–º–æ—Ç—Ä–µ—Ç—å</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stream-card" data-type="training">
                            <div class="stream-preview">
                                <div class="stream-thumbnail">üé≠</div>
                                <div class="live-indicator">LIVE</div>
                                <div class="viewer-count">856</div>
                            </div>
                            <div class="stream-info">
                                <h3>–£—Ä–æ–∫ –≤–æ–∫–∞–ª–∞: –¥—ã—Ö–∞–Ω–∏–µ</h3>
                                <p>–ë–∞–∑–æ–≤—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö</p>
                                <div class="stream-actions">
                                    <button class="join-btn">üìö –£—á–∏—Ç—å—Å—è</button>
                                    <button class="watch-btn">üëÅÔ∏è –°–º–æ—Ç—Ä–µ—Ç—å</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stream-card" data-type="karaoke">
                            <div class="stream-preview">
                                <div class="stream-thumbnail">üåü</div>
                                <div class="live-indicator">LIVE</div>
                                <div class="viewer-count">2.1K</div>
                            </div>
                            <div class="stream-info">
                                <h3>–ë–∏—Ç–≤–∞ –≥–æ–ª–æ—Å–æ–≤</h3>
                                <p>–ö—Ç–æ —Å–ø–æ–µ—Ç –ª—É—á—à–µ? –ì–æ–ª–æ—Å—É–π!</p>
                                <div class="stream-actions">
                                    <button class="join-btn">‚öîÔ∏è –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</button>
                                    <button class="watch-btn">üëÅÔ∏è –°–º–æ—Ç—Ä–µ—Ç—å</button>
                                </div>
                            </div>
                        </div>

                        <div class="stream-card" data-type="duet">
                            <div class="stream-preview">
                                <div class="stream-thumbnail">üé∏</div>
                                <div class="live-indicator">LIVE</div>
                                <div class="viewer-count">643</div>
                            </div>
                            <div class="stream-info">
                                <h3>–î–∂–µ–º-—Å–µ—Å—Å–∏—è</h3>
                                <p>–ò–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏—è —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏</p>
                                <div class="stream-actions">
                                    <button class="join-btn">üé∂ –ò–≥—Ä–∞—Ç—å</button>
                                    <button class="watch-btn">üëÅÔ∏è –°–º–æ—Ç—Ä–µ—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
                <aside class="live-feed-sidebar">
                    <section>
                        <h3>üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h3>
                        <div class="action-buttons">
                            <button class="quick-btn concert" data-mode="concert">–ö–æ–Ω—Ü–µ—Ä—Ç</button>
                            <button class="quick-btn karaoke" data-mode="karaoke">–ö–∞—Ä–∞–æ–∫–µ</button>
                            <button class="quick-btn practice" data-mode="rehearsal">–†–µ–ø–µ—Ç–∏—Ü–∏—è</button>
                            <button class="quick-btn live" data-mode="live">LIVE</button>
                        </div>
                    </section>
                    
                    <section>
                        <h3>üìä –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
                        <p>–°–µ–≥–æ–¥–Ω—è –≤—ã —É–∂–µ —Å–ø–µ–ª–∏ <strong>23 –º–∏–Ω—É—Ç—ã</strong> –∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ <strong>7 –ø–µ—Å–µ–Ω</strong> —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é <strong>91%</strong>.</p>
                    </section>
                    
                    <section>
                        <h3>üî• –¢—Ä–µ–Ω–¥—ã –Ω–µ–¥–µ–ª–∏</h3>
                        <p><strong>#1</strong> Bohemian Rhapsody (+1,847)</p>
                        <p><strong>#2</strong> Someone Like You (+1,523)</p>
                        <p><strong>#3</strong> Perfect (+1,401)</p>
                    </section>
                    
                    <section>
                        <h3>üë• –î—Ä—É–∑—å—è –æ–Ω–ª–∞–π–Ω</h3>
                        <div class="friends-list">
                            <div class="friend-item">
                                <span class="friend-name">üü¢ –ú–∞—Ä–∏—è</span>
                                <button class="friend-join-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                            </div>
                            <div class="friend-item">
                                <span class="friend-name">üü¢ –ê–ª–µ–∫—Å–µ–π</span>
                                <button class="friend-join-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                            </div>
                            <div class="friend-item">
                                <span class="friend-name">üü° –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞</span>
                                <button class="friend-join-btn">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
                            </div>
                        </div>
                    </section>
                </aside>
            </main>
        </div>
        
        <!-- Live Mode Containers -->
        <div id="live-video-container" class="hidden">
            <div class="live-header">
                <h1 class="live-title">LIVE</h1>
            </div>
            <video id="live-video" autoplay muted playsinline disablepictureinpicture disableremoteplayback webkit-playsinline x-webkit-airplay="deny"></video>
            <div id="lyrics-overlay"></div>
            <div class="live-controls">
                <button id="record-button" class="live-control-btn">
                    <i class="fas fa-record-vinyl"></i> –ó–∞–ø–∏—Å—å
                </button>
                <button id="stream-button" class="live-control-btn">
                    <i class="fas fa-broadcast-tower"></i> –°—Ç—Ä–∏–º
                </button>
                <button id="toggle-effects" class="live-control-btn">
                    <i class="fas fa-mask"></i> –≠—Ñ—Ñ–µ–∫—Ç—ã
                </button>
                <button id="settings-button" class="live-control-btn">
                    <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
            </div>
            <div id="recording-indicator" class="hidden">REC</div>
        </div>
        
        <!-- Masks Panel -->
        <div id="masks-panel" class="hidden">
            <div class="masks-header">
                <button class="back-button"><i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
                <h2>–ú–∞—Å–∫–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã</h2>
            </div>
            <div class="categories">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div id="masks-container">
                <!-- –ú–∞—Å–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <!-- Modal Container -->
        <div id="modal-container" class="hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                    <button id="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>
        
        <!-- Status Display for Live mode -->
        <div id="live-status-display" class="hidden"></div>
    </div>
    
    <!-- Transport Panel Toggle Button - MOVED -->

    <!-- Modal Block Editor Container (initially hidden) -->
    <div id="modal-block-editor-container" class="hidden">
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –±–ª–æ–∫–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
        <div id="integrated-block-editor-content">
            <div class="editor-layout">  <!-- –ù–æ–≤—ã–π flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
                <main class="editor-main-area"> <!-- –û–±–ª–∞—Å—Ç—å –¥–ª—è –±–ª–æ–∫–æ–≤ —Ç–µ–∫—Å—Ç–∞ -->
                    <header class="editor-header">
                        <h1>–†–µ–∂–∏–º –°–æ–∑–¥–∞–Ω–∏—è –ë–ª–æ–∫–æ–≤</h1>
                        <!-- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫" –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ editor-sidebar -->
                    </header>
                    <div class="block-list-area">
                        <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –±–ª–æ–∫–∏ —Ç–µ–∫—Å—Ç–∞ -->
                    </div>
                </main>
                <aside class="editor-sidebar"> <!-- –ù–æ–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ -->
                    <button id="add-block-btn" class="btn">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
                    <button id="edit-mode-toggle-btn" class="btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
                    <button id="delete-selected-block-btn" class="btn btn-danger" disabled>–£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫</button>
                    <button id="save-track-modal-btn" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–µ–∫</button>
                    <button id="cancel-edit-modal-btn" class="btn">–û—Ç–º–µ–Ω–∞</button>
                    <div id="block-editor-status" style="margin-top: 10px; font-size: 0.9em; color: #555;">–†–µ–¥–∞–∫—Ç–æ—Ä –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω.</div>
                </aside>
            </div>
        </div>
    </div>

    <!-- Component Scripts -->
    <script>
        // Ensure scripts load in the correct order with proper initialization
        window.addEventListener('load', function() {
            console.log('Application fully loaded, components initialized');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Live —Ä–µ–∂–∏–º–∞
            if (sessionStorage.getItem('activateLiveMode') === 'true') {
                console.log('Auto-activating Live mode from redirect');
                sessionStorage.removeItem('activateLiveMode');
                
                // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                setTimeout(function() {
                    // –ù–∞—Ö–æ–¥–∏–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É Live
                    const liveButton = document.querySelector('.mode-button[data-mode="live"]');
                    if (liveButton) {
                        liveButton.click();
                    } else {
                        console.error('Live mode button not found');
                    }
                }, 1000);
            }
        });
    </script>
    <script src="js/debug-config.js"></script>

    <!-- üéµ CORE ENGINE & UTILITIES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rtf.js@0.4.0/dist/rtf.min.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/state-manager.js"></script>
    
    <!-- üêô –ö–†–ê–ö–ï–ù: AudioRouter –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ -->
    <script src="js/audio-router.js"></script>
    
    <!-- üîç –ö–†–ê–ö–ï–ù: –°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ -->
    <script src="js/kraken-diagnostics.js"></script>
    
    <!-- üéµ COMPONENT SCRIPTS -->
    <script src="js/audio-engine.js"></script>
    <script src="js/enhanced-rtf-processor.js"></script>
    <script src="js/rtf-parser.js"></script>
    <script src="js/rtf-parser-adapter.js"></script>
    <script src="js/lyrics-display.js"></script>
    <script src="js/track-catalog.js"></script>
    <script src="js/marker-manager.js"></script>
    <script src="js/waveform-editor.js"></script>
    <script src="js/text-style-manager.js"></script>
    <script src="js/loopblock-manager.js"></script>
    <script src="js/block-loop-control.js"></script>
    <script src="js/background-effects-engine.js"></script>
    <script src="js/mask-system.js"></script>
    <script src="js/rtf-parser-integration.js"></script>
    <script src="js/modal-block-editor.js"></script>
    <script src="js/piano-keyboard.js"></script>
    <script src="js/karaoke-background.js"></script>
    
    <!-- Live Mode Scripts -->
    <script src="js/live-mode.js"></script>
    <script src="js/live-feed.js"></script>

    <!-- üöÄ MAIN APPLICATION SCRIPT -->
    <script src="js/app.js"></script>

    <div id="block-editor-container" class="hidden"></div>
    <div id="font-selector-modal" class="hidden"></div>
    <div id="loading-overlay" class="hidden">
        <div class="loading-spinner"></div>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–∫–∞...</p>
    </div>
    <script src="js/audio-settings-ui.js"></script>

    <!-- Director System Scripts -->
    <script src="js/director-system/director-core.js"></script>
    <script src="js/director-system/train-timeline-controller.js"></script>
    <script src="js/director-ui/director-page.js"></script>
    
    <!-- Main Application Script -->
    <script src="js/app.js"></script>
</body>
</html> 