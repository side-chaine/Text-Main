---
description: 
globs: 
alwaysApply: undefined
---
# Build & Deploy

- Окружение определяется в `js/dev-flags.js`:
  - `window.__BUILD__`: 'dev' для локального (`file://`, `localhost`), иначе 'prod'
  - `window.__DB_NAME`: 'TextAppDB_DEV' в dev, 'TextAppDB' в prod
  - `window.__ADMIN__`: true в dev, false в prod
  - `window.__DEBUG__`: true в dev, false в prod
- Имя IndexedDB во всех модулях брать из `window.__DB_NAME` с фоллбеком на 'TextAppDB'.
- Пользовательская версия (prod):
  - скрыты админ-элементы (очистка БД, удаление треков из общей базы и т.п.)
  - логи уровня `debug` выключены
  - фоновые менеджеры работают с проверками `mode-*`
- Dev-версия (локально) включает весь функционал и расширенные логи.

## Деплой на сайт
- Проверка DoD перед выкладкой: треки грузятся и сохраняются, поиск показывает все треки, воспроизведение из каталога стартует в Караоке, Sync не открывается.
- Загрузка страницы через HTTPS.
- Включить кэш статики с версионированием файлов.
- Не менять `__BUILD__` вручную — окружение определяется автоматически; при необходимости можно принудить `window.__BUILD__ = 'prod'` в `<head>` перед `dev-flags.js`. 