<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>beLive - Тестовая Страница Каталога</title>
    <link rel="stylesheet" href="../css/styles.css"> <!-- Подключаем основные стили -->
    <link rel="stylesheet" href="../css/track-catalog.css"> <!-- Если есть специфические стили каталога -->
    <style>
        body {
            background-color: #1a1a1a;
            color: #f0f0f0;
            font-family: 'Arial', sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column; /* Stack header and main content */
            min-height: 100vh; /* Full viewport height */
            box-sizing: border-box;
        }

        /* Top navigation for modes */
        .mode-nav {
            background-color: #2a2a2a;
            padding: 10px 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            border-bottom: 1px solid #3a3a3a;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        .mode-btn {
            background-color: #4a4a4a;
            color: #f0f0f0;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, color 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            font-weight: bold;
        }
        .mode-btn:hover {
            background-color: #00e676;
            color: #1a1a1a;
            transform: translateY(-2px);
        }
        .mode-btn.active {
            background-color: #00e676;
            color: #1a1a1a;
            box-shadow: 0 0 10px #00e676;
        }

        .catalog-main-content {
            flex-grow: 1;
            display: flex;
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
            /* overflow: hidden; */ /* This was hiding the uploader and the scrollbar */
        }

        .catalog-column {
            flex: 1;
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
            /* display: flex; */ /* This was the problem, it prevented natural block flow and overflow */
            /* flex-direction: column; */ /* This was the problem */
            overflow-y: auto;
            max-height: 100%;
            position: relative;
        }

        .column-header {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #00e676;
            text-align: center;
            padding-bottom: 5px;
            border-bottom: 2px solid #00e676;
        }

        /* Specific styles for My Music */
        .my-music-column .artist-group {
            background-color: #3a3a3a;
            border-radius: 5px;
            margin-bottom: 10px;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
            overflow: hidden;
        }
        .my-music-column .artist-group:hover {
            background-color: #4a4a4a;
        }
        .my-music-column .artist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: #eee;
            padding-right: 5px;
        }
        .my-music-column .artist-header span:last-child {
            color: #bbb;
            font-size: 0.9em;
        }
        .my-music-column .toggle-icon {
            display: inline-block;
            width: 1em;
            text-align: center;
            transition: transform 0.3s ease;
        }
        .my-music-column .artist-group.expanded .toggle-icon {
            transform: rotate(90deg);
        }
        .my-music-column .track-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
            border-top: 1px solid #4a4a4a;
            padding-top: 10px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding-top 0.3s ease-out, margin-top 0.3s ease-out;
        }
        .my-music-column .track-list.expanded {
            max-height: 500px;
            padding-top: 10px;
            margin-top: 10px;
        }
        .my-music-column .track-item {
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #bbb;
            border-bottom: 1px dashed #4a4a4a;
        }
        .my-music-column .track-item:last-child {
            border-bottom: none;
        }
        .my-music-column .track-item-controls button {
            background: none;
            border: none; /* Removed border */
            color: #00e676;
            padding: 5px;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 5px; /* Adjusted margin */
            transition: background-color 0.2s, color 0.2s;
            font-size: 1.1em; /* Larger icons */
        }
        .my-music-column .track-item-controls button:hover {
            background-color: rgba(0, 230, 118, 0.2); /* Subtle hover */
            color: #00ff8c;
        }
        .my-music-column .track-item-controls button.favorite {
            color: #ffc107; /* Star color */
        }
        .my-music-column .track-item-controls button.favorite.active {
            background-color: #ffc107;
            color: #1a1a1a;
        }
        .my-music-column .track-meta-info {
            font-size: 0.8em;
            color: #888;
            margin-left: 10px;
        }

        /* Specific styles for Trends & Suggestions */
        .trends-suggestions-column .section-title {
            font-size: 1.2em;
            color: #00e676;
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 1px solid #4a4a4a;
            padding-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .trends-suggestions-column .track-card {
            background-color: #3a3a3a;
            border-radius: 8px;
            margin-bottom: 10px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .trends-suggestions-column .track-card:hover {
            background-color: #4a4a4a;
            transform: translateY(-3px);
        }
        .trends-suggestions-column .album-art-placeholder {
            width: 60px;
            height: 60px;
            background-color: #555;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em; /* Make icon bigger */
            color: #888;
            flex-shrink: 0;
            border: 1px solid #666;
            /* Removed problematic background-image from external service */
        }
        .trends-suggestions-column .track-details {
            flex-grow: 1;
        }
        .trends-suggestions-column .track-details .title {
            font-weight: bold;
            color: #eee;
            margin-bottom: 3px;
            font-size: 1.05em;
        }
        .trends-suggestions-column .track-details .artist {
            font-size: 0.85em;
            color: #aaa;
        }
        .trends-suggestions-column .trend-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #00e676, #00b0ff); /* Gradient for trend */
            border-radius: 0 0 8px 8px;
            transform-origin: left;
            animation: trend-pulse 2s infinite alternate;
        }
        @keyframes trend-pulse {
            from { width: 0%; opacity: 0.5; }
            to { width: 100%; opacity: 1; }
        }

        /* Specific styles for Smart Search */
        .smart-search-column input[type="text"] {
            width: calc(100% - 20px);
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #555;
            border-radius: 8px;
            background-color: #3a3a3a;
            color: #f0f0f0;
            font-size: 1.1em;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .smart-search-column input[type="text"]:focus {
            border-color: #00e676;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 0 8px rgba(0, 230, 118, 0.5);
        }
        .smart-search-column .search-results {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px; /* Space for scrollbar */
        }
        .smart-search-column .search-result-item {
            padding: 10px 8px;
            border-bottom: 1px solid #4a4a4a;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.95em;
            display: flex; /* For icon alignment */
            align-items: center;
            gap: 10px;
        }
        .smart-search-column .search-result-item:last-child {
            border-bottom: none;
        }
        .smart-search-column .search-result-item:hover {
            background-color: #4a4a4a;
        }
        .highlight-exact {
            color: #00e676;
            font-weight: bold;
        }
        .highlight-partial {
            color: #a2f900;
        }
        .search-icon {
            font-size: 1.2em;
            color: #bbb;
            flex-shrink: 0;
        }

        /* --- Uploader Styles --- */
        .upload-section {
            background-color: #3a3a3a;
            border-radius: 8px;
            margin-top: 20px;
            padding: 15px;
        }
        .upload-section h3 {
            font-size: 1.2em;
            color: #00e676;
            margin-top: 0;
            text-align: center;
        }
        .drop-zones-container {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .drop-zone {
            flex: 1;
            border: 2px dashed #555;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: #888;
            cursor: pointer;
            transition: border-color 0.3s, background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            height: 100px; /* Fixed height */
        }
        .drop-zone:hover, .drop-zone.drag-over {
            border-color: #00e676;
            background-color: rgba(0, 230, 118, 0.1);
        }
        .drop-zone.has-file {
            border-color: #00e676;
            border-style: solid;
        }
        .drop-zone-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .drop-zone-message {
            font-size: 0.9em;
        }
        .file-name {
            color: #00e676;
            font-weight: bold;
        }
        .upload-buttons-container {
            display: flex;
            gap: 15px;
        }
        .upload-buttons-container .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s;
        }
        .upload-buttons-container .json-btn {
            background-color: #555;
            color: #eee;
        }
        .upload-buttons-container .json-btn:hover {
            background-color: #666;
        }
        .upload-buttons-container .json-btn.has-file {
            background-color: #00e676;
            color: #1a1a1a;
        }
        .upload-buttons-container .upload-btn {
            background-color: #00e676;
            color: #1a1a1a;
            font-weight: bold;
        }
        .upload-buttons-container .upload-btn:hover {
            background-color: #00ff8c;
        }
        #json-file-input {
            display: none;
        }

        /* --- Modal Styles --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-overlay.visible {
            display: flex;
        }
        .modal-content {
            background-color: #2a2a2a;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            width: 600px;
            max-width: 90%;
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #888;
            font-size: 1.5em;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close-btn:hover {
            color: #fff;
        }

    </style>
</head>
<body>
    <div class="mode-nav">
        <button class="mode-btn">КОНЦЕРТНЫЙ</button>
        <button class="mode-btn">КАРАОКЕ</button>
        <button class="mode-btn active">РЕПЕТИЦИЯ</button>
        <button class="mode-btn">LIVE</button>
        <button class="mode-btn">КАТАЛОГ</button>
        <button class="mode-btn" id="show-upload-modal-btn">Загрузить трек</button>
    </div>

    <!-- Modal for Uploader -->
    <div id="uploader-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="modal-close-btn" class="modal-close-btn">&times;</button>
            <div class="upload-section">
                <h3>Загрузить новый трек</h3>
                <div class="drop-zones-container">
                    <div id="instrumental-drop-zone" class="drop-zone" title="Инструментал">
                        <div class="drop-zone-icon">🎹</div>
                        <div class="drop-zone-message"></div>
                    </div>
                    <div id="vocals-drop-zone" class="drop-zone" title="Вокал">
                        <div class="drop-zone-icon">🎤</div>
                        <div class="drop-zone-message"></div>
                    </div>
                    <div id="lyrics-drop-zone" class="drop-zone" title="Текст">
                        <div class="drop-zone-icon">✍️</div>
                        <div class="drop-zone-message"></div>
                    </div>
                </div>
                <div class="upload-buttons-container">
                    <input type="file" id="json-file-input" accept=".json">
                    <button id="json-upload-button" class="btn json-btn">Прикрепить JSON с маркерами</button>
                    <button id="upload-track-button" class="btn upload-btn">Загрузить</button>
                </div>
            </div>
        </div>
    </div>


    <div class="catalog-main-content">
        <!-- Первая колонка: My Music / My Box -->
        <div class="catalog-column my-music-column">
            <h2 class="column-header">Моя Музыка</h2>
            <div id="my-music-list">
                <!-- Динамически загружаемый контент будет здесь -->
            </div>
        </div>

        <!-- Вторая колонка: Тренды и Предложения -->
        <div class="catalog-column trends-suggestions-column">
            <h2 class="column-header">Тренды и Предложения</h2>
            
            <div class="section-title">📈 Тренды</div>
            <div id="trends-grid" class="trends-grid">
                <!-- Динамически загружаемый контент будет здесь -->
            </div>

            <div class="section-title">💡 Предложения для тебя</div>
            <div id="suggestions-grid" class="trends-grid">
                <!-- Динамически загружаемый контент будет здесь -->
            </div>
        </div>

        <!-- Третья колонка: Умный Поиск -->
        <div class="catalog-column smart-search-column">
            <input type="text" placeholder="Поиск треков, исполнителей, текстов...">
            <div class="search-results">
                <div class="search-result-item">
                    <span class="search-icon">🎵</span>
                    <span class="highlight-exact">Linkin</span> <span class="highlight-exact">Park</span> - New Divide <br><span style="font-size: 0.8em; color: #888;">Исполнитель: Linkin Park</span>
                </div>
                <div class="search-result-item">
                    <span class="search-icon">🎤</span>
                    <span class="highlight-partial">Linkin</span> <span class="highlight-partial">Park</span> - When They Come For Me <br><span style="font-size: 0.8em; color: #888;">Исполнитель: Linkin Park</span>
                </div>
                <div class="search-result-item">
                    <span class="search-icon">✍️</span>
                    Eminem feat. <span class="highlight-partial">Rihanna</span> - Love The Way You Lie <br><span style="font-size: 0.8em; color: #888;">Исполнитель: Eminem</span>
                </div>
                <div class="search-result-item">
                    <span class="search-icon">🎵</span>
                    Aerosmith - Dream On (<span class="highlight-partial">I'm</span> not a <span class="highlight-partial">criminal</span>) <br><span style="font-size: 0.8em; color: #888;">Исполнитель: Aerosmith</span>
                </div>
                <div class="search-result-item">
                    <span class="search-icon">🎤</span>
                    Queen - <span class="highlight-exact">Bohemian</span> Rhapsody <br><span style="font-size: 0.8em; color: #888;">Исполнитель: Queen</span>
                </div>
                <div class="search-result-item">
                    <span class="search-icon">✍️</span>
                    Led Zeppelin - <span class="highlight-exact">Stairway</span> to Heaven <br><span style="font-size: 0.8em; color: #888;">Исполнитель: Led Zeppelin</span>
                </div>
                <div class="search-result-item">
                    <span class="search-icon">🎵</span>
                    The Beatles - <span class="highlight-exact">Yesterday</span> <br><span style="font-size: 0.8em; color: #888;">Исполнитель: The Beatles</span>
                </div>
                <div class="search-result-item">
                    <span class="search-icon">🎤</span>
                    John Lennon - <span class="highlight-partial">Imagine</span> <br><span style="font-size: 0.8em; color: #888;">Исполнитель: John Lennon</span>
                </div>
                <div class="search-result-item">
                    <span class="search-icon">✍️</span>
                    <span class="highlight-partial">Nirvana</span> - Smells Like Teen Spirit <br><span style="font-size: 0.8em; color: #888;">Исполнитель: Nirvana</span>
                </div>
                <div class="search-result-item">
                    <span class="search-icon">🎵</span>
                    Michael Jackson - <span class="highlight-partial">Billie</span> Jean <br><span style="font-size: 0.8em; color: #888;">Исполнитель: Michael Jackson</span>
                </div>
                <div class="search-result-item">
                    <span class="search-icon">🎤</span>
                    Adele - <span class="highlight-partial">Rolling</span> in the Deep <br><span style="font-size: 0.8em; color: #888;">Исполнитель: Adele</span>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { renderMyMusic } from './components/MyMusic.js';
        import { initializeUploader } from './components/Uploader.js';

        // --- ДАННЫЕ И РЕНДЕРИНГ ДЛЯ ТРЕНДОВ И ПРЕДЛОЖЕНИЙ ---

        const trendsData = [
            { title: "Bohemian Rhapsody", artist: "Queen", isTrending: true },
            { title: "Stairway to Heaven", artist: "Led Zeppelin", isTrending: true },
            { title: "Shape of You", artist: "Ed Sheeran", isTrending: true },
            { title: "Blinding Lights", artist: "The Weeknd", isTrending: true },
            { title: "Bad Guy", artist: "Billie Eilish", isTrending: true },
        ];
        
        const suggestionsData = [
            { title: "Yesterday", artist: "The Beatles", isTrending: false },
            { title: "Hallelujah", artist: "Leonard Cohen", isTrending: false },
            { title: "Smells Like Teen Spirit", artist: "Nirvana", isTrending: false },
            { title: "Hotel California", artist: "Eagles", isTrending: false },
            { title: "Imagine", artist: "John Lennon", isTrending: false },
        ];

        function renderTrackCards(container, data) {
            if (!container) return; // Защита от ошибок, если элемент не найден
            container.innerHTML = '';

            data.forEach(track => {
                const trackCard = document.createElement('div');
                trackCard.className = 'track-card';
                trackCard.innerHTML = `
                    <div class="album-art-placeholder">${track.isTrending ? '📈' : '💡'}</div>
                    <div class="track-details">
                        <div class="title">${track.title}</div>
                        <div class="artist">${track.artist}</div>
                    </div>
                    ${track.isTrending ? '<div class="trend-indicator"></div>' : ''}
                `;
                trackCard.addEventListener('click', () => {
                    alert(`Выбран трек: ${track.title} - ${track.artist}`);
                });
                container.appendChild(trackCard);
            });
        }

        function renderTrendsAndSuggestions() {
            const trendsGrid = document.getElementById('trends-grid');
            const suggestionsGrid = document.getElementById('suggestions-grid');
            renderTrackCards(trendsGrid, trendsData);
            renderTrackCards(suggestionsGrid, suggestionsData);
        }

        // --- Улучшенный Mock search functionality ---
        const searchInput = document.querySelector('.smart-search-column input[type="text"]');
        const searchResultsContainer = document.querySelector('.smart-search-column .search-results');
        const mockResults = [
            { title: "New Divide", artist: "Linkin Park", lyrics: "I remember new divide in my mind", type: "🎵" },
            { title: "When They Come For Me", artist: "Linkin Park", lyrics: "When they come for me I'll be gone", type: "🎤" },
            { title: "Love The Way You Lie", artist: "Eminem", lyrics: "Just gonna stand there and watch me burn", type: "✍️" },
            { title: "Dream On", artist: "Aerosmith", lyrics: "Every time that I look in the mirror", type: "🎵" },
            { title: "Bohemian Rhapsody", artist: "Queen", lyrics: "Is this the real life? Is this just fantasy?", type: "🎤" },
            { title: "Stairway to Heaven", artist: "Led Zeppelin", lyrics: "And she's buying a stairway to heaven", type: "✍️" },
            { title: "Yesterday", artist: "The Beatles", lyrics: "Yesterday, all my troubles seemed so far away", type: "🎵" },
            { title: "Imagine", artist: "John Lennon", lyrics: "Imagine there's no heaven", type: "🎤" },
            { title: "Smells Like Teen Spirit", artist: "Nirvana", lyrics: "Load up on guns, bring your friends", type: "✍️" },
            { title: "Billie Jean", artist: "Michael Jackson", lyrics: "Billie Jean is not my lover", type: "🎵" },
            { title: "Rolling in the Deep", artist: "Adele", lyrics: "We could have had it all", type: "🎤" },
        ];

        function renderSearchResults(results) {
            searchResultsContainer.innerHTML = '';
            results.forEach(track => {
                const item = document.createElement('div');
                item.className = 'search-result-item';
                
                let displayedText = `${track.title} - ${track.artist}`;
                if (track.highlighted) {
                    displayedText = track.highlighted;
                }

                item.innerHTML = `<span class="search-icon">${track.type}</span>${displayedText}`;
                searchResultsContainer.appendChild(item);
            });
        }
        
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.toLowerCase().trim();

            if (!query) {
                renderSearchResults(mockResults); // Восстанавливаем список по умолчанию
                return;
            }

            const filteredResults = mockResults.filter(track => {
                return track.title.toLowerCase().includes(query) ||
                        (track.artist && track.artist.toLowerCase().includes(query)) ||
                        (track.lyrics && track.lyrics.toLowerCase().includes(query));
            }).map(track => {
                const highlighted = `${track.title} - ${track.artist}`.replace(new RegExp(query, 'gi'), (match) => {
                    const isExactWord = new RegExp(`\\b${query}\\b`, 'gi').test(match);
                    return `<span class="highlight-${isExactWord ? 'exact' : 'partial'}">${match}</span>`;
                });
                return {...track, highlighted };
            });
            
            renderSearchResults(filteredResults);
        });
        
        // Инициализация рендеринга при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            const myMusicList = document.getElementById('my-music-list');
            renderMyMusic(myMusicList);
            initializeUploader();
            renderTrendsAndSuggestions();
            renderSearchResults(mockResults); // Первоначальный рендеринг полного списка для поиска
        });
    </script>
</body>
</html> 