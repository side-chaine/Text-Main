<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Avatar - Enhanced Prototype</title>
    <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #eee;
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }
        
        h1 {
            color: #00d4ff;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
            margin-bottom: 10px;
        }
        
        .status {
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        
        .status.active {
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }

        .main-layout {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            width: 100%;
            max-width: 1400px;
            justify-content: center;
        }

        /* –ë–û–ö–û–í–´–ï –ü–ê–ù–ï–õ–ò –ö–ê–°–¢–û–ú–ò–ó–ê–¶–ò–ò */
        .customization-panel {
            width: 280px;
            background: rgba(0, 20, 40, 0.9);
            border: 2px solid #00d4ff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.2);
            backdrop-filter: blur(10px);
            opacity: 0;
            transform: translateX(-50px);
            transition: all 0.5s ease;
            pointer-events: none;
        }

        .customization-panel.visible {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
        }

        .customization-panel.right {
            transform: translateX(50px);
        }

        .customization-panel.right.visible {
            transform: translateX(0);
        }

        .panel-title {
            color: #00ff88;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .carrier-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .carrier-item {
            background: rgba(20, 30, 50, 0.8);
            border: 2px solid #333;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .carrier-item:hover {
            border-color: #00d4ff;
            background: rgba(30, 45, 70, 0.9);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
        }

        .carrier-item.selected {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
        }

        .carrier-emoji {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }

        .carrier-name {
            color: #fff;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .carrier-3d {
            width: 100%;
            height: 80px;
            border-radius: 8px;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.5);
        }

        .approved-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
        }

        .approved-info {
            flex: 1;
        }

        .approved-name {
            color: #00ff88;
            font-size: 12px;
            font-weight: bold;
        }

        .approved-settings {
            color: #aaa;
            font-size: 10px;
        }

        .remove-btn {
            background: #ff4444;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            color: white;
            cursor: pointer;
            font-size: 12px;
        }

        .settings-panel {
            background: rgba(20, 30, 50, 0.9);
            border: 2px solid #00d4ff;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
        }

        .setting-group {
            margin-bottom: 15px;
        }

        .setting-label {
            color: #00d4ff;
            font-size: 12px;
            margin-bottom: 5px;
            display: block;
        }

        .setting-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        .setting-slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #00d4ff;
            cursor: pointer;
        }

        .setting-value {
            color: #fff;
            font-size: 12px;
            text-align: center;
            margin-top: 5px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            padding: 2px 6px;
        }

        .save-btn {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }
        
        .container {
            position: relative;
            width: 800px;
            height: 600px;
            border: 2px solid #00d4ff;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
            background: radial-gradient(circle at center, rgba(26, 26, 46, 0.8), rgba(22, 33, 62, 0.9));
        }
        
        #video-tracking, #canvas-output {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #video-tracking {
            display: none;
        }
        
        #canvas-output {
            background: transparent;
            pointer-events: none;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            background: linear-gradient(45deg, #6a1b9a, #8e24aa);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 27, 154, 0.4);
        }

        .customize-btn {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            font-size: 16px;
            padding: 12px 24px;
        }

        .customize-btn:hover {
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 20px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>üé≠ Live Avatar - Enhanced Prototype</h1>
    <div class="status" id="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
    
    <div class="main-layout">
        <!-- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ - –¢–ï–°–¢–û–í–´–ï –ù–û–°–ò–¢–ï–õ–ò -->
        <div class="customization-panel" id="testPanel">
            <div class="panel-title">üß™ –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–æ—Å–∏—Ç–µ–ª–∏</div>
            <div class="carrier-grid" id="testCarriers">
                <!-- –ù–æ—Å–∏—Ç–µ–ª–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            
            <!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
            <div class="settings-panel">
                <div class="setting-group">
                    <label class="setting-label">–®–∏—Ä–∏–Ω–∞</label>
                    <input type="range" class="setting-slider" id="widthSlider" min="0.5" max="3" step="0.1" value="1">
                    <div class="setting-value" id="widthValue">1.0</div>
                </div>
                <div class="setting-group">
                    <label class="setting-label">–í—ã—Å–æ—Ç–∞</label>
                    <input type="range" class="setting-slider" id="heightSlider" min="0.5" max="3" step="0.1" value="1">
                    <div class="setting-value" id="heightValue">1.0</div>
                </div>
                <div class="setting-group">
                    <label class="setting-label">–°–º–µ—â–µ–Ω–∏–µ</label>
                    <input type="range" class="setting-slider" id="offsetSlider" min="-100" max="100" step="5" value="0">
                    <div class="setting-value" id="offsetValue">0</div>
                </div>
                <button class="save-btn" onclick="saveCurrentCarrier()">üíæ –°–û–•–†–ê–ù–ò–¢–¨ –í –ö–û–õ–õ–ï–ö–¶–ò–Æ</button>
            </div>
        </div>

        <!-- –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –û–ë–õ–ê–°–¢–¨ -->
        <div>
            <div class="container">
                <video id="video-tracking" autoplay muted playsinline></video>
                <canvas id="canvas-output" width="800" height="600"></canvas>
            </div>
            
            <div class="controls">
                <button class="customize-btn" onclick="toggleCustomization()">üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è</button>
                <button onclick="toggleDebug()">Debug Mode</button>
                <button onclick="changeAvatarColor()">–°–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç</button>
                <button onclick="toggleLimbs()">–í–∫–ª/–í—ã–∫–ª –ö–æ–Ω–µ—á–Ω–æ—Å—Ç–∏</button>
                <button onclick="setGesture('default')" title="Default">üñêÔ∏è</button>
                <button onclick="setGesture('peace')" title="Peace">‚úåÔ∏è</button>
                <button onclick="setGesture('rock')" title="Rock">ü§ò</button>
                <button onclick="setGesture('yo')" title="Yo!">üëâ</button>
            </div>
        </div>

        <!-- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨ - –û–î–û–ë–†–ï–ù–ù–ê–Ø –ö–û–õ–õ–ï–ö–¶–ò–Ø -->
        <div class="customization-panel right" id="approvedPanel">
            <div class="panel-title">‚úÖ –û–¥–æ–±—Ä–µ–Ω–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è</div>
            <div id="approvedCarriers" class="carrier-grid">
                <div class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –Ω–æ—Å–∏—Ç–µ–ª–µ–π</div>
            </div>
        </div>
    </div>

    <!-- MediaPipe —á–µ—Ä–µ–∑ –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1620248257/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1635988162/pose.js"></script>

    <script>
        const videoTrackingElement = document.getElementById('video-tracking');
        const canvasElement = document.getElementById('canvas-output');
        const canvasCtx = canvasElement.getContext('2d');
        const statusElement = document.getElementById('status');

        const canvasWidth = canvasElement.width;
        const canvasHeight = canvasElement.height;
        
        let debugMode = false;
        let avatarColors = ['#6a1b9a', '#e91e63', '#2196f3', '#4caf50', '#ff9800'];
        let currentColorIndex = 0;
        
        let showLimbs = true; // –§–ª–∞–≥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω–µ—á–Ω–æ—Å—Ç–µ–π (–≤–∫–ª—é—á–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
        let avatarHorizontalOffset = 0;
        let avatarRunPhase = 0;
        let previousAvatarHorizontalOffset = 0;
        
        // --- –°–ò–°–¢–ï–ú–ê –ñ–ï–°–¢–û–í ---
        let currentGesture = 'default';
        
        // --- –°–ò–°–¢–ï–ú–ê –°–ì–õ–ê–ñ–ò–í–ê–ù–ò–Ø ---
        // –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–≥–ª–∞–∂–µ–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –¥—Ä–æ–∂–∞–Ω–∏—è
        let smoothedPoints = {}; 
        // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è (0 - –æ—á–µ–Ω—å –ø–ª–∞–≤–Ω–æ, 1 - –±–µ–∑ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è)
        const smoothingFactor = 0.4;

        // --- –°–ò–°–¢–ï–ú–ê –ö–ê–°–¢–û–ú–ò–ó–ê–¶–ò–ò ---
        let customizationVisible = false;
        let currentCarrier = null;
        let approvedCarriers = JSON.parse(localStorage.getItem('approvedCarriers') || '[]');
        let scene, renderer, threeCamera;

        // –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–æ—Å–∏—Ç–µ–ª–∏
        const TEST_CARRIERS = [
            { id: 'jets', name: '–†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–≤–∏–≥–∞—Ç–µ–ª–∏', emoji: 'üöÄ', type: 'jets' },
            { id: 'hoverboard', name: '–•–æ–≤–µ—Ä–±–æ—Ä–¥', emoji: 'üõ∏', type: 'hoverboard' },
            { id: 'mech_legs', name: '–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –Ω–æ–≥–∏', emoji: 'ü¶æ', type: 'mech_legs' },
            { id: 'dragon_wings', name: '–ö—Ä—ã–ª—å—è –¥—Ä–∞–∫–æ–Ω–∞', emoji: 'üêâ', type: 'dragon_wings' },
            { id: 'rocket_boots', name: '–†–∞–∫–µ—Ç–Ω—ã–µ —Å–∞–ø–æ–≥–∏', emoji: 'üë¢', type: 'rocket_boots' },
            { id: 'energy_platform', name: '–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞', emoji: '‚ö°', type: 'energy_platform' },
            { id: 'spider_legs', name: '–ü–∞—É—á—å–∏ –Ω–æ–≥–∏', emoji: 'üï∑Ô∏è', type: 'spider_legs' },
            { id: 'flame_wheels', name: '–û–≥–Ω–µ–Ω–Ω—ã–µ –∫–æ–ª–µ—Å–∞', emoji: 'üî•', type: 'flame_wheels' }
        ];

        function drawHand(ctx, wristX, wristY, elbowX, elbowY, gesture, limbColor) {
            const angle = Math.atan2(wristY - elbowY, wristX - elbowX) + Math.PI / 2;

            ctx.fillStyle = '#ffcc80'; // –¶–≤–µ—Ç –ª–∞–¥–æ–Ω–∏ (—Å–≤–µ—Ç–ª–µ–µ —á–µ–º —Ä—É–∫–∞)
            
            // --- –õ–∞–¥–æ–Ω—å ---
            ctx.save();
            ctx.translate(wristX, wristY);
            ctx.rotate(angle);
            ctx.beginPath();
            // –õ–∞–¥–æ–Ω—å - —Å–ª–µ–≥–∫–∞ —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
            ctx.moveTo(-12, -10);
            ctx.lineTo(12, -10);
            ctx.lineTo(15, 10);
            ctx.lineTo(-15, 10);
            ctx.closePath();
            ctx.fill();

            // --- –ü–∞–ª—å—Ü—ã ---
            const fingerLength = 22;
            const fingerWidth = 8;
            const thumbLength = 16;
            
            ctx.fillStyle = limbColor; // –ü–∞–ª—å—Ü—ã —Ç–æ–≥–æ –∂–µ —Ü–≤–µ—Ç–∞ —á—Ç–æ –∏ —Ä—É–∫–∞

            const drawFinger = (x, y, length, width, fingerAngle = 0) => {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(fingerAngle);
                ctx.beginPath();
                ctx.roundRect(-width / 2, -length, width, length, width / 2);
                ctx.fill();
                ctx.restore();
            };

            switch (gesture) {
                case 'peace':
                    drawFinger(-7, -8, fingerLength, fingerWidth); // –£–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π
                    drawFinger(7, -8, fingerLength, fingerWidth); // –°—Ä–µ–¥–Ω–∏–π
                    break;
                case 'rock':
                    drawFinger(-10, -8, fingerLength, fingerWidth); // –£–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π
                    drawFinger(10, -8, fingerLength * 0.8, fingerWidth); // –ú–∏–∑–∏–Ω–µ—Ü
                    // –ë–æ–ª—å—à–æ–π –ø–∞–ª–µ—Ü –ø—Ä–∏–∂–∏–º–∞–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ
                     drawFinger(-2, -2, thumbLength, fingerWidth, Math.PI / 3);
                    break;
                case 'yo':
                    drawFinger(0, -8, fingerLength * 1.1, fingerWidth); // –°—Ä–µ–¥–Ω–∏–π, —á—É—Ç—å –¥–ª–∏–Ω–Ω–µ–µ
                    break;
                case 'fist':
                     // –ü—Ä–æ—Å—Ç–æ –ª–∞–¥–æ–Ω—å
                    break;
                default: // default (open palm)
                    // 4 –ø–∞–ª—å—Ü–∞
                    drawFinger(-11, -8, fingerLength * 0.9, fingerWidth, -0.1);
                    drawFinger(-3, -9, fingerLength, fingerWidth);
                    drawFinger(5, -9, fingerLength, fingerWidth, 0.1);
                    drawFinger(12, -8, fingerLength * 0.8, fingerWidth, 0.2);
                    // –ë–æ–ª—å—à–æ–π –ø–∞–ª–µ—Ü
                    drawFinger(-14, 0, thumbLength, fingerWidth, Math.PI / 2.5);
                    break;
            }

            ctx.restore();
        }
        
        function drawJetEngines(ctx, centerX, baseY, width, runPhase, isRunning, velocity) {
            ctx.save();

            // 1. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
            const platformHeight = 20;
            const platformWidth = width * 1.3; // –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —á—É—Ç—å —à–∏—Ä–µ –ø–ª–µ—á
            const platformY = baseY + 5; 

            ctx.fillStyle = '#78909c';
            ctx.strokeStyle = '#455a64';
            ctx.lineWidth = 4;
            
            ctx.beginPath();
            ctx.roundRect(centerX - platformWidth / 2, platformY, platformWidth, platformHeight, 8);
            ctx.fill();
            ctx.stroke();

            // 2. –ú–æ—â–Ω—ã–µ –¥–≤–∏–≥–∞—Ç–µ–ª–∏
            const engineWidth = platformWidth / 2.2;
            const engineHeight = 70;

            const drawEngine = (xOffset) => {
                const engineX = centerX + xOffset;
                const engineY = platformY - engineHeight + 10; // –°–∏–¥—è—Ç –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
                
                // –ö–æ—Ä–ø—É—Å –∏ –¥–µ—Ç–∞–ª–∏ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
                ctx.fillStyle = '#b0bec5';
                ctx.strokeStyle = '#546e7a';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.rect(engineX - engineWidth / 2, engineY, engineWidth, engineHeight);
                ctx.fill();
                ctx.stroke();
                ctx.fillStyle = '#78909c';
                ctx.beginPath();
                ctx.rect(engineX - engineWidth / 2, engineY, engineWidth, 15);
                ctx.fill();
                
                // –°–æ–ø–ª–æ
                const nozzleY = engineY + engineHeight;
                ctx.fillStyle = '#455a64';
                ctx.beginPath();
                ctx.moveTo(engineX - engineWidth / 2 + 5, nozzleY);
                ctx.lineTo(engineX + engineWidth / 2 - 5, nozzleY);
                ctx.lineTo(engineX + engineWidth / 2 - 10, nozzleY + 15);
                ctx.lineTo(engineX - engineWidth / 2 + 10, nozzleY + 15);
                ctx.closePath();
                ctx.fill();

                // 3. –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–ò–ó–ò–ö–ê –ü–õ–ê–ú–ï–ù–ò - –ø–ª–∞–º—è –ª–µ—Ç–∏—Ç –≤ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É –æ—Ç –¥–≤–∏–∂–µ–Ω–∏—è
                const flameAngle = -velocity * 0.08; // –í–û–ó–í–†–ê–©–ê–ï–ú –ü–†–ê–í–ò–õ–¨–ù–£–Æ –§–ò–ó–ò–ö–£ - –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                const flameLength = 40 + (isRunning ? 80 : 0) + Math.abs(velocity * 2);

                ctx.save();
                ctx.translate(engineX, nozzleY + 10);
                ctx.rotate(flameAngle); // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞–∫–ª–æ–Ω

                const grad = ctx.createLinearGradient(0, 0, 0, flameLength);
                grad.addColorStop(0, 'rgba(0, 255, 255, 1)');
                grad.addColorStop(0.5, 'rgba(100, 181, 246, 0.7)');
                grad.addColorStop(1, 'rgba(30, 136, 229, 0)');
                
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.moveTo(-engineWidth / 2 + 15, 0);
                ctx.lineTo(engineWidth / 2 - 15, 0);
                ctx.lineTo(0, flameLength);
                ctx.closePath();
                ctx.fill();
                
                ctx.restore();
            };
            
            drawEngine(-platformWidth / 4); 
            drawEngine(platformWidth / 4);
            
            ctx.restore();
        }
        
        function updateStatus(message, isActive = false) {
            statusElement.textContent = message;
            statusElement.className = isActive ? 'status active' : 'status';
        }

        function drawAvatar(results) {
            const poseLandmarks = results.poseLandmarks;
            const segmentationMask = results.segmentationMask;
            const image = results.image;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            canvasCtx.save();
            
            // --- –°–æ–∑–¥–∞–µ–º –æ—Ç–∑–µ—Ä–∫–∞–ª–µ–Ω–Ω—É—é –∫–æ–ø–∏—é –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ---
            const mirroredLandmarks = poseLandmarks ? 
                poseLandmarks.map(lm => ({...lm, visibility: lm.visibility, x: 1 - lm.x, y: lm.y })) : null;

            // --- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è –≥–æ–ª–æ–≤—ã ---
            const horizontalVelocity = avatarHorizontalOffset - previousAvatarHorizontalOffset;
            previousAvatarHorizontalOffset = avatarHorizontalOffset;

            // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê: –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–∑–µ—Ä–∫–∞–ª–µ–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
            if (mirroredLandmarks && mirroredLandmarks[0].visibility > 0.6) {
                const deviation = 0.5 - mirroredLandmarks[0].x; // –ò–ù–í–ï–†–¢–ò–†–£–ï–ú –û–ë–†–ê–¢–ù–û –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
                avatarHorizontalOffset = avatarHorizontalOffset * 0.9 + (deviation * 600) * 0.1;
            } else {
                // –ü–ª–∞–≤–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ —Ü–µ–Ω—Ç—Ä, –µ—Å–ª–∏ –ø–æ–∑–∞ –Ω–µ –≤–∏–¥–Ω–∞
                avatarHorizontalOffset *= 0.95;
            }

            // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
            canvasCtx.clearRect(0, 0, canvasWidth, canvasHeight);

            // --- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —Å–º–µ—â–µ–Ω–∏—è ---
            const scale = 0.4; // –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –∞–≤–∞—Ç–∞—Ä–∞
            const verticalLift = -60; // –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥—ä–µ–º –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
            const newWidth = canvasWidth * scale;
            const newHeight = canvasHeight * scale;
            const offsetX = (canvasWidth - newWidth) / 2;
            const offsetY = (canvasHeight - newHeight) / 2 + verticalLift;

            // –°–¥–≤–∏–≥–∞–µ–º –Ω–∞—á–∞–ª–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –≤ —Ç–æ—á–∫—É, –≥–¥–µ –±—É–¥–µ—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω –∞–≤–∞—Ç–∞—Ä + —Å–º–µ—â–µ–Ω–∏–µ
            canvasCtx.translate(offsetX + avatarHorizontalOffset, offsetY);
            canvasCtx.scale(scale, scale);

            // --- –û–¢–†–ò–°–û–í–ö–ê –°–ï–ì–ú–ï–ù–¢–ò–†–û–í–ê–ù–ù–û–ì–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ---
            if (segmentationMask && image) {
                 // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –≤–æ–∫—Ä—É–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                canvasCtx.shadowColor = avatarColors[currentColorIndex];
                canvasCtx.shadowBlur = 25;
                canvasCtx.shadowOffsetX = 0;
                canvasCtx.shadowOffsetY = 0;

                // –†–∏—Å—É–µ–º –º–∞—Å–∫—É —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è —Å–≤–µ—á–µ–Ω–∏—è
                canvasCtx.drawImage(segmentationMask, 0, 0, canvasWidth, canvasHeight);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–Ω—å –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –æ—Ç—Ä–∏—Å–æ–≤–æ–∫
                canvasCtx.shadowColor = 'transparent';

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º 'source-in', —á—Ç–æ–±—ã –æ–±—Ä–µ–∑–∞—Ç—å –≤–∏–¥–µ–æ –ø–æ –º–∞—Å–∫–µ
                canvasCtx.globalCompositeOperation = 'source-in';
                canvasCtx.drawImage(image, 0, 0, canvasWidth, canvasHeight);

            } else if (image) {
                // –ï—Å–ª–∏ –º–∞—Å–∫–∏ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ —Ä–∏—Å—É–µ–º –≤–∏–¥–µ–æ (–Ω–∞ —Å–ª—É—á–∞–π —Å–±–æ—è)
                canvasCtx.drawImage(image, 0, 0, canvasWidth, canvasHeight);
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º –Ω–∞–ª–æ–∂–µ–Ω–∏—è
            canvasCtx.globalCompositeOperation = 'source-over';

            // --- –û–¢–†–ò–°–û–í–ö–ê –ê–í–ê–¢–ê–†–ê ---
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–∑–µ—Ä–∫–∞–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–∑—ã
            const poseDetected = mirroredLandmarks && mirroredLandmarks.length > 0;
            
            if (poseDetected) {
                const limbColor = '#ffab40';
                
                if (showLimbs) {
                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–æ–Ω–µ—á–Ω–æ—Å—Ç–µ–π
                    canvasCtx.strokeStyle = limbColor;
                    canvasCtx.lineWidth = 18;
                    canvasCtx.lineCap = 'round';

                    // --- –õ–æ–≥–∏–∫–∞ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è ---
                    const smoothPoint = (key, newPoint) => {
                        if (!newPoint) return null;
                        const oldPoint = smoothedPoints[key];
                        const newSmoothedPoint = { x: newPoint.x, y: newPoint.y };

                        if (oldPoint) {
                            newSmoothedPoint.x = oldPoint.x * (1 - smoothingFactor) + newPoint.x * smoothingFactor;
                            newSmoothedPoint.y = oldPoint.y * (1 - smoothingFactor) + newPoint.y * smoothingFactor;
                        }
                        
                        smoothedPoints[key] = { x: newSmoothedPoint.x, y: newSmoothedPoint.y };
                        return { ...newSmoothedPoint, visibility: newPoint.visibility };
                    };

                    // --- –†–ï–ê–ö–¢–ò–í–ù–´–ï –î–í–ò–ì–ê–¢–ï–õ–ò ---
                    const leftShoulder = mirroredLandmarks[11];
                    const rightShoulder = mirroredLandmarks[12];
                    const leftHip = mirroredLandmarks[23];
                    const rightHip = mirroredLandmarks[24];

                    let hipCenterX = canvasWidth / 2;
                    if (leftShoulder && rightShoulder && leftShoulder.visibility > 0.3) {
                        hipCenterX = ((leftShoulder.x + rightShoulder.x) / 2) * canvasWidth;
                    }

                    // --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–∑—ã –∞–≤–∞—Ç–∞—Ä–∞ ---
                    let avatarBaseY = 500; // –ë–∞–∑–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞
                    let avatarWidth = 150; // –®–∏—Ä–∏–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

                    if (leftShoulder && rightShoulder && leftShoulder.visibility > 0.4) {
                        avatarWidth = Math.abs(leftShoulder.x - rightShoulder.x) * canvasWidth;
                    }

                    if (leftHip && rightHip && leftHip.visibility > 0.4) {
                        avatarBaseY = Math.max(leftHip.y, rightHip.y) * canvasHeight + 10; 
                    } else if (leftShoulder && rightShoulder) {
                        avatarBaseY = ((leftShoulder.y + rightShoulder.y) / 2) * canvasHeight + 150;
                    }
                    
                    const isRunning = Math.abs(horizontalVelocity) > 1;
                    
                    if (isRunning) {
                        avatarRunPhase += 0.4;
                    }
                    
                    drawJetEngines(canvasCtx, hipCenterX, avatarBaseY, avatarWidth, avatarRunPhase, isRunning, horizontalVelocity);
                
                    updateStatus(`‚úÖ –ü–æ–∑–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞!`, true);
                } else {
                     updateStatus(`‚úÖ –ü–æ–∑–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞!`, true);
                }

            } else {
                updateStatus(`üßç‚Äç‚ôÇÔ∏è –ü–æ—à–µ–≤–µ–ª–∏—Ç–µ—Å—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è`, false);
                smoothedPoints = {}; // –°–±—Ä–æ—Å —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ –ø–æ–∑—ã
            }
            
            // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            if (debugMode && mirroredLandmarks) {
                drawConnectors(canvasCtx, mirroredLandmarks, POSE_CONNECTIONS, {color: '#00FF00', lineWidth: 2});
                drawLandmarks(canvasCtx, mirroredLandmarks, {color: '#FF0000', lineWidth: 1, radius: 3});
            }

             // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
             canvasCtx.restore();
        }

        function onResults(results) {
            drawAvatar(results);
        }

        function toggleDebug() {
            debugMode = !debugMode;
        }
        
        function toggleLimbs() {
            showLimbs = !showLimbs;
        }
        
        function changeAvatarColor() {
            currentColorIndex = (currentColorIndex + 1) % avatarColors.length;
        }

        function setGesture(gesture) {
            currentGesture = gesture;
            console.log(`Gesture set to: ${gesture}`);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MediaPipe
        async function initializeMediaPipe() {
            try {
                updateStatus("–ó–∞–≥—Ä—É–∑–∫–∞ MediaPipe Pose...");
                const pose = new Pose({
                    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1635988162/${file}`
                });
                pose.setOptions({
                    modelComplexity: 1,
                    smoothLandmarks: true,
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5,
                    enableSegmentation: true,
                    selfieMode: true
                });
                pose.onResults(onResults);

                updateStatus("–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...");
                
                // –ü–æ–ª—É—á–∞–µ–º –ø–æ—Ç–æ–∫ –∫–∞–º–µ—Ä—ã
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { width: 800, height: 600 }
                });
                
                videoTrackingElement.srcObject = stream;
                
                const camera = new Camera(videoTrackingElement, {
                    onFrame: async () => {
                        await pose.send({ image: videoTrackingElement });
                    },
                    width: 800,
                    height: 600
                });
                
                await camera.start();
                updateStatus("üé• –ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞ - –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è POSE!", true);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                updateStatus("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–º–µ—Ä—É –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.");
            }
        }

        // –ó–∞–ø—É—Å–∫
        window.addEventListener('load', () => {
            initializeMediaPipe();
            setupSettingsHandlers();
        });

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–µ–π
        function toggleCustomization() {
            customizationVisible = !customizationVisible;
            const testPanel = document.getElementById('testPanel');
            const approvedPanel = document.getElementById('approvedPanel');
            
            if (customizationVisible) {
                testPanel.classList.add('visible');
                approvedPanel.classList.add('visible');
                if (!scene) {
                    initThreeJS();
                }
                renderTestCarriers();
                renderApprovedCarriers();
            } else {
                testPanel.classList.remove('visible');
                approvedPanel.classList.remove('visible');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Three.js –¥–ª—è 3D –ø—Ä–µ–≤—å—é
        function initThreeJS() {
            console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Three.js –¥–ª—è –ø—Ä–µ–≤—å—é...');
            
            if (typeof THREE === 'undefined') {
                console.error('‚ùå THREE.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                return false;
            }
            
            scene = new THREE.Scene();
            
            // –°–æ–∑–¥–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–≤—å—é –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
            console.log('‚úÖ Three.js –≥–æ—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–µ–≤—å—é');
            return true;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ 3D –ø—Ä–µ–≤—å—é –Ω–æ—Å–∏—Ç–µ–ª—è
        function create3DPreview(container, carrierType) {
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            
            renderer.setSize(width, height);
            renderer.setClearColor(0x000000, 0);
            container.appendChild(renderer.domElement);
            
            // –û—Å–≤–µ—â–µ–Ω–∏–µ
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 10, 5);
            scene.add(directionalLight);
            
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å –Ω–æ—Å–∏—Ç–µ–ª—è
            const carrier = createCarrierModel(carrierType);
            scene.add(carrier);
            
            camera.position.set(0, 2, 5);
            camera.lookAt(0, 0, 0);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            function animate() {
                requestAnimationFrame(animate);
                if (carrier) {
                    carrier.rotation.y += 0.01;
                }
                renderer.render(scene, camera);
            }
            animate();
            
            return { scene, renderer, camera, carrier };
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ 3D –º–æ–¥–µ–ª–∏ –Ω–æ—Å–∏—Ç–µ–ª—è
        function createCarrierModel(type) {
            const group = new THREE.Group();
            
            switch (type) {
                case 'jets':
                    // –†–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–≤–∏–≥–∞—Ç–µ–ª–∏
                    const jetGeometry = new THREE.CylinderGeometry(0.3, 0.4, 1, 8);
                    const jetMaterial = new THREE.MeshPhongMaterial({ color: 0x888888 });
                    
                    const jet1 = new THREE.Mesh(jetGeometry, jetMaterial);
                    jet1.position.x = -0.5;
                    const jet2 = new THREE.Mesh(jetGeometry, jetMaterial);
                    jet2.position.x = 0.5;
                    
                    group.add(jet1, jet2);
                    break;
                    
                case 'hoverboard':
                    // –•–æ–≤–µ—Ä–±–æ—Ä–¥
                    const boardGeometry = new THREE.BoxGeometry(2, 0.1, 0.6);
                    const boardMaterial = new THREE.MeshPhongMaterial({ color: 0x00ff88 });
                    const board = new THREE.Mesh(boardGeometry, boardMaterial);
                    group.add(board);
                    break;
                    
                case 'energy_platform':
                    // –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
                    const platformGeometry = new THREE.CylinderGeometry(1, 1, 0.2, 8);
                    const platformMaterial = new THREE.MeshPhongMaterial({ 
                        color: 0x6600ff,
                        emissive: 0x220066
                    });
                    const platform = new THREE.Mesh(platformGeometry, platformMaterial);
                    group.add(platform);
                    break;
                    
                default:
                    // –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å
                    const defaultGeometry = new THREE.BoxGeometry(1, 0.5, 1);
                    const defaultMaterial = new THREE.MeshPhongMaterial({ color: 0x0099ff });
                    const defaultMesh = new THREE.Mesh(defaultGeometry, defaultMaterial);
                    group.add(defaultMesh);
            }
            
            return group;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –Ω–æ—Å–∏—Ç–µ–ª–µ–π
        function renderTestCarriers() {
            const container = document.getElementById('testCarriers');
            container.innerHTML = '';
            
            TEST_CARRIERS.forEach(carrier => {
                const item = document.createElement('div');
                item.className = 'carrier-item';
                item.onclick = () => selectCarrier(carrier);
                
                item.innerHTML = `
                    <span class="carrier-emoji">${carrier.emoji}</span>
                    <div class="carrier-name">${carrier.name}</div>
                    <div class="carrier-3d" id="preview-${carrier.id}"></div>
                `;
                
                container.appendChild(item);
                
                // –°–æ–∑–¥–∞–µ–º 3D –ø—Ä–µ–≤—å—é –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ DOM
                setTimeout(() => {
                    const previewContainer = document.getElementById(`preview-${carrier.id}`);
                    if (previewContainer) {
                        create3DPreview(previewContainer, carrier.type);
                    }
                }, 100);
            });
        }

        // –í—ã–±–æ—Ä –Ω–æ—Å–∏—Ç–µ–ª—è
        function selectCarrier(carrier) {
            // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
            document.querySelectorAll('.carrier-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π
            event.target.closest('.carrier-item').classList.add('selected');
            
            currentCarrier = carrier;
            console.log(`üéØ –í—ã–±—Ä–∞–Ω –Ω–æ—Å–∏—Ç–µ–ª—å: ${carrier.name}`);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ—Å–∏—Ç–µ–ª—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
        function saveCurrentCarrier() {
            if (!currentCarrier) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ—Å–∏—Ç–µ–ª—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!');
                return;
            }
            
            const settings = {
                width: parseFloat(document.getElementById('widthSlider').value),
                height: parseFloat(document.getElementById('heightSlider').value),
                offset: parseInt(document.getElementById('offsetSlider').value)
            };
            
            const approvedCarrier = {
                ...currentCarrier,
                settings,
                id: `${currentCarrier.id}_${Date.now()}` // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
            };
            
            approvedCarriers.push(approvedCarrier);
            localStorage.setItem('approvedCarriers', JSON.stringify(approvedCarriers));
            
            renderApprovedCarriers();
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            const saveBtn = document.querySelector('.save-btn');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = '‚úÖ –°–û–•–†–ê–ù–ï–ù–û!';
            saveBtn.style.background = 'linear-gradient(45deg, #4caf50, #66bb6a)';
            
            setTimeout(() => {
                saveBtn.textContent = originalText;
                saveBtn.style.background = 'linear-gradient(45deg, #ff6b35, #f7931e)';
            }, 2000);
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –Ω–æ—Å–∏—Ç–µ–ª–µ–π
        function renderApprovedCarriers() {
            const container = document.getElementById('approvedCarriers');
            
            if (approvedCarriers.length === 0) {
                container.innerHTML = '<div class="empty-state">–ü–æ–∫–∞ –Ω–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –Ω–æ—Å–∏—Ç–µ–ª–µ–π</div>';
                return;
            }
            
            container.innerHTML = '';
            
            approvedCarriers.forEach(carrier => {
                const item = document.createElement('div');
                item.className = 'approved-item';
                
                item.innerHTML = `
                    <div class="approved-info">
                        <div class="approved-name">${carrier.emoji} ${carrier.name}</div>
                        <div class="approved-settings">W:${carrier.settings.width} H:${carrier.settings.height} Y:${carrier.settings.offset}</div>
                    </div>
                    <button class="remove-btn" onclick="removeApprovedCarrier('${carrier.id}')">√ó</button>
                `;
                
                container.appendChild(item);
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –Ω–æ—Å–∏—Ç–µ–ª—è –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        function removeApprovedCarrier(carrierId) {
            approvedCarriers = approvedCarriers.filter(c => c.id !== carrierId);
            localStorage.setItem('approvedCarriers', JSON.stringify(approvedCarriers));
            renderApprovedCarriers();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å–ª–∞–π–¥–µ—Ä–æ–≤
        function setupSettingsHandlers() {
            const widthSlider = document.getElementById('widthSlider');
            const heightSlider = document.getElementById('heightSlider');
            const offsetSlider = document.getElementById('offsetSlider');
            
            const widthValue = document.getElementById('widthValue');
            const heightValue = document.getElementById('heightValue');
            const offsetValue = document.getElementById('offsetValue');
            
            widthSlider.oninput = () => widthValue.textContent = widthSlider.value;
            heightSlider.oninput = () => heightValue.textContent = heightSlider.value;
            offsetSlider.oninput = () => offsetValue.textContent = offsetSlider.value;
        }
    </script>
</body>
</html> 